<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Prolonged Impact of Redlining in San Jose</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.css" rel="stylesheet"/>
  <script src="https://unpkg.com/maplibre-gl@1.15.2/dist/maplibre-gl.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f8f9fa;
    }

    /* Header and Navigation */
    .header {
      background: linear-gradient(135deg, #1a2a6c, #2a4b8c);
      color: white;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }

    .tabs {
      display: flex;
      gap: 2px;
      background: #2a4b8c;
      padding: 0 10px;
      overflow-x: auto;
    }

    .tab {
      padding: 12px 16px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .tab.active {
      background: white;
      color: #1a2a6c;
    }

    /* Main Content Areas */
    .content-section {
      display: none;
      position: absolute;
      top: 106px;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      overflow-y: auto;
      background: white;
    }

    .content-section.active {
      display: block;
    }

    #map-container {
      padding: 0;
      overflow: hidden;
    }

    /* Map Elements */
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }

    .map-controls {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .map-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: white;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #info {
      position: absolute;
      left: 15px;
      top: 15px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 2;
      max-width: 300px;
      font-size: 14px;
    }

    .legend {
      position: absolute;
      right: 15px;
      bottom: 30px;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 2;
      font-size: 13px;
    }

    .swatch {
      width: 18px;
      height: 12px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,0.08);
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }

    .legend .row {
      margin-bottom: 6px;
    }

    #layer-controls {
      position: absolute;
      top: 60px;
      left: 15px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-size: 13px;
      z-index: 2;
    }

    #layer-controls label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }

    /* Popup Styles */
    .popup-table {
      font-size: 13px;
      line-height: 1.4;
      max-width: 340px;
    }

    .popup-scroll {
      max-height: 300px;
      overflow: auto;
      padding-right: 8px;
    }

    .metric {
      font-weight: 600;
      margin-right: 6px;
    }

    .fullscreen-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #1a2a6c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      z-index: 3;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      overflow-y: auto;
      padding: 40px 20px;
    }

    .modal-content {
      background: white;
      max-width: 800px;
      margin: 0 auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.3);
    }

    .close-modal {
      float: right;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: #666;
    }

    /* Content Styles */
    .content-card {
      background: white;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .chart-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .chart-container {
      width: 100%;
      margin: 15px 0;
      border: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 4px;
      overflow: hidden;
    }

    .responsive-iframe {
      width: 100%;
      height: 350px;
      border: none;
    }

    /* Circles Visualization */
    .circles-vis {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      position: relative;
      margin: 40px 0;
    }

    .circle {
      position: absolute;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.3s;
    }

    .circle:hover {
      transform: scale(1.05);
    }

    .circle-info {
      display: none;
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
      color: white;
    }

    /* Contact Form */
    .contact-form {
      max-width: 600px;
      margin: 0 auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: Arial, Helvetica, sans-serif;
    }

    .form-group textarea {
      min-height: 150px;
    }

    .submit-btn {
      background: #1a2a6c;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .tabs {
        overflow-x: auto;
        padding-bottom: 5px;
      }

      .tab {
        padding: 10px 12px;
        font-size: 14px;
      }

      .chart-grid {
        grid-template-columns: 1fr;
      }

      .responsive-iframe {
        height: 300px;
      }

      .circles-vis {
        height: 250px;
      }

      .circle {
        padding: 15px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
<!-- Header with Title -->
<div class="header">
  <h1>Prolonged Impact of Redlining in San Jose</h1>
</div>

<!-- Navigation Tabs -->
<div class="tabs">
  <div id="tab-map" class="tab active">Map</div>
  <div id="tab-redlining" class="tab">What is Redlining</div>
  <div id="tab-methodology" class="tab">Study Methodology</div>
  <div id="tab-graphs" class="tab">Graphs & Results</div>
  <div id="tab-policy" class="tab">Policy Implications</div>
  <div id="tab-contact" class="tab">Contact</div>
  <div id="tab-tutorial" class="tab">Tutorial</div>
</div>

<!-- Map Section -->
<div id="map-container" class="content-section active">
  <div id="map"></div>

  <!-- Map Controls -->
  <div class="map-controls">
    <button class="map-btn" id="zoom-in">+</button>
    <button class="map-btn" id="zoom-out">-</button>
  </div>

  <div id="info">Hover over a zone for information</div>

  <div class="legend" id="legend">
    <div style="font-weight:600; margin-bottom:8px;">HOLC Grade</div>
    <div class="row"><span class="swatch" style="background:#2ca25f"></span>A - Best</div>
    <div class="row"><span class="swatch" style="background:#1f78b4"></span>B - Still Desirable</div>
    <div class="row"><span class="swatch" style="background:#f1c40f"></span>C - Declining</div>
    <div class="row"><span class="swatch" style="background:#e34a33"></span>D - Hazardous</div>
  </div>

  <div id="layer-controls">
    <label><input type="checkbox" id="toggle-holc" checked> HOLC Zones</label>
    <label><input type="checkbox" id="toggle-rail"> Rail</label>
    <label><input type="checkbox" id="toggle-light-rail" checked> Light Rail</label>
    <label><input type="checkbox" id="toggle-broadband"> Broadband Anchors</label>
  </div>
</div>

<!-- What is Redlining Section -->
<div id="redlining-content" class="content-section">
  <div class="content-card">
    <h2>What is Redlining?</h2>
    <p>Redlining was a discriminatory practice that began in the 1930s when the federal government's Home Owners' Loan Corporation (HOLC) created maps of American cities to assess lending risk. These maps color-coded neighborhoods based on their perceived creditworthiness:</p>

    <div style="display: flex; align-items: center; gap: 15px; margin: 20px 0; flex-wrap: wrap;">
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#2ca25f; margin-right: 8px;"></span>
        <span><strong>A (Green)</strong> - "Best"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#1f78b4; margin-right: 8px;"></span>
        <span><strong>B (Blue)</strong> - "Still Desirable"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#f1c40f; margin-right: 8px;"></span>
        <span><strong>C (Yellow)</strong> - "Declining"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#e34a33; margin-right: 8px;"></span>
        <span><strong>D (Red)</strong> - "Hazardous"</strong></span>
      </div>
    </div>

    <p>Neighborhoods with predominantly Black, Hispanic, immigrant, or Jewish residents were typically marked in red (D zones) and denied home loans and other financial services, regardless of individual residents' creditworthiness.</p>

    <h3>Impact on San Jose</h3>
    <p>In San Jose, redlining practices systematically disadvantaged communities of color, creating patterns of disinvestment that continue to affect these neighborhoods today. The historically redlined areas correlate strongly with current patterns of inequality in infrastructure, housing values, and opportunity.</p>

    <p>This discriminatory practice lasted for decades and was only officially outlawed with the passage of the Fair Housing Act in 1968. However, the legacy of redlining continues to shape American cities, including San Jose.</p>
  </div>
</div>

<!-- Study Methodology Section -->
<div id="methodology-content" class="content-section">
  <div class="content-card">
    <h2>Study Methodology</h2>
    <p>This research examines the lasting impacts of historical redlining practices on contemporary neighborhood characteristics in San Jose, California.</p>

    <h3>Data Sources</h3>
    <ul>
      <li><strong>Historical Redlining Maps:</strong> Digitized HOLC maps from the University of Richmond's "Mapping Inequality" project</li>
      <li><strong>Demographic Data:</strong> U.S. Census Bureau American Community Survey (2015-2019)</li>
      <li><strong>Infrastructure Data:</strong> City of San Jose open data portal, OpenStreetMap, and other local government sources</li>
      <li><strong>Property Values:</strong> Zillow Home Value Index and county assessor records</li>
    </ul>

    <h3>Analytical Approach</h3>
    <p>The study employed Geographic Information Systems (GIS) to overlay historical redlining maps with contemporary data. Spatial analysis techniques included:</p>

    <ul>
      <li>Geographic overlay of historical HOLC zones with current census tracts</li>
      <li>Spatial joins to aggregate contemporary data within historical boundaries</li>
      <li>Buffer analysis to examine infrastructure distribution</li>
      <li>Statistical comparison of neighborhood characteristics across HOLC grades</li>
    </ul>

    <h3>Variables Analyzed</h3>
    <p>The research examined multiple dimensions of neighborhood inequality:</p>

    <div class="chart-grid">
      <div>
        <h4>Housing & Economic</h4>
        <ul>
          <li>Median home values</li>
          <li>Homeownership rates</li>
          <li>Property tax revenue</li>
          <li>Rent burden</li>
        </ul>
      </div>
      <div>
        <h4>Infrastructure & Services</h4>
        <ul>
          <li>Broadband internet access</li>
          <li>Public transportation access</li>
          <li>Street trees and green space</li>
          <li>Public facilities</li>
        </ul>
      </div>
      <div>
        <h4>Demographic</h4>
        <ul>
          <li>Racial composition</li>
          <li>Educational attainment</li>
          <li>Income inequality</li>
          <li>Poverty rates</li>
        </ul>
      </div>
      <div>
        <h4>Environmental</h4>
        <ul>
          <li>Proximity to pollution sources</li>
          <li>Urban heat island effect</li>
          <li>Flood risk</li>
          <li>Park access</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Graphs & Results Section -->
<div id="graphs-content" class="content-section">
  <div class="content-card">
    <h2>Graphs & Results</h2>
    <p>The analysis reveals persistent disparities between neighborhoods with different historical HOLC grades across multiple dimensions of infrastructure and opportunity.</p>

    <!-- Circles Visualization -->
    <div class="circles-vis">
      <div class="circle" style="width: 280px; height: 280px; background: rgba(66, 133, 244, 0.7);" data-category="broadband">
        Broadband Access
      </div>
      <div class="circle" style="width: 220px; height: 220px; background: rgba(52, 168, 83, 0.7);" data-category="green">
        Green Infrastructure
      </div>
      <div class="circle" style="width: 180px; height: 180px; background: rgba(251, 188, 5, 0.7);" data-category="housing">
        Housing Values
      </div>
      <div class="circle" style="width: 140px; height: 140px; background: rgba(234, 67, 53, 0.7);" data-category="demographics">
        Racial Demographics
      </div>
    </div>

    <!-- Broadband Access -->
    <div class="circle-info" id="broadband-info" style="background: rgba(66, 133, 244, 0.9);">
      <h3>Broadband Access Disparities</h3>
      <div class="chart-container">
        <iframe class="responsive-iframe" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRg1FjbeS85-cFpzGsRdobMtjb_Iu-JJJDjllgzePXZXgnHbJYPX94m5tHMcTfh2ebHqLBUT15gZWRM/pubchart?oid=280698462&amp;format=interactive"></iframe>
      </div>
      <p>Historically redlined areas (Grades C & D) have significantly fewer broadband anchors per square kilometer, limiting digital access and economic opportunities.</p>
    </div>

    <!-- Green Infrastructure -->
    <div class="circle-info" id="green-info" style="background: rgba(52, 168, 83, 0.9);">
      <h3>Green Infrastructure Disparities</h3>
      <div class="chart-container">
        <iframe class="responsive-iframe" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRg1FjbeS85-cFpzGsRdobMtjb_Iu-JJJDjllgzePXZXgnHbJYPX94m5tHMcTfh2ebHqLBUT15gZWRM/pubchart?oid=1010210670&amp;format=interactive"></iframe>
      </div>
      <div class="chart-container">
        <iframe class="responsive-iframe" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRg1FjbeS85-cFpzGsRdobMtjb_Iu-JJJDjllgzePXZXgnHbJYPX94m5tHMcTfh2ebHqLBUT15gZWRM/pubchart?oid=539685908&amp;format=interactive"></iframe>
      </div>
      <p>Neighborhoods graded D have far fewer street trees, contributing to urban heat island effects and reduced quality of life. Furthermore, there is significantly more rail, leading to noise and air pollution, detrimental for the health of citizens.</p>
    </div>

    <!-- Housing Values -->
    <div class="circle-info" id="housing-info" style="background: rgba(251, 188, 5, 0.9);">
      <h3>Housing Value Disparities</h3>
      <div class="chart-container">
        <iframe class="responsive-iframe" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRg1FjbeS85-cFpzGsRdobMtjb_Iu-JJJDjllgzePXZXgnHbJYPX94m5tHMcTfh2ebHqLBUT15gZWRM/pubchart?oid=1395206384&amp;format=interactive"></iframe>
      </div>
      <p>The legacy of redlining is clearly visible in current housing values, with formerly redlined areas having significantly lower median values.</p>
    </div>

    <!-- Racial Demographics -->
    <div class="circle-info" id="demographics-info" style="background: rgba(234, 67, 53, 0.9);">
      <h3>Racial Demographic Patterns</h3>
      <div class="chart-container">
        <iframe class="responsive-iframe" seamless frameborder="0" scrolling="no" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRg1FjbeS85-cFpzGsRdobMtjb_Iu-JJJDjllgzePXZXgnHbJYPX94m5tHMcTfh2ebHqLBUT15gZWRM/pubchart?oid=134847115&amp;format=interactive"></iframe>
      </div>
      <p>Historical patterns of segregation persist, with formerly redlined areas still having higher concentrations of Hispanic and Black residents.</p>
    </div>
  </div>
</div>

<!-- Policy Implications Section -->
<div id="policy-content" class="content-section">
  <div class="content-card">
    <h2>Policy Implications</h2>
    <p>The research findings demonstrate that historical redlining continues to shape contemporary inequality in San Jose. Addressing these disparities requires targeted policy interventions.</p>

    <h3>Key Findings</h3>
    <ul>
      <li><strong>Disinvestment:</strong> Formerly redlined areas have the lowest median housing values, reducing tax revenue and limiting infrastructure funding</li>
      <li><strong>Persistent Racial Disparities:</strong> These areas still have higher concentrations of Hispanic and Black residents, reflecting lasting segregation</li>
      <li><strong>Infrastructure Deficits:</strong> Fewer street trees contribute to higher temperatures, while limited broadband access restricts economic opportunities</li>
      <li><strong>Environmental Burdens:</strong> Historically redlined areas have more exposure to pollution sources and less access to green space</li>
    </ul>

    <h3>Policy Recommendations</h3>

    <div class="chart-grid">
      <div>
        <h4>Housing & Economic Justice</h4>
        <ul>
          <li>Implement targeted down payment assistance programs in historically redlined areas</li>
          <li>Create community land trusts to preserve affordable housing</li>
          <li>Expand property tax relief programs for long-term residents</li>
          <li>Incentivize community-owned businesses and cooperatives</li>
        </ul>
      </div>

      <div>
        <h4>Infrastructure Investment</h4>
        <ul>
          <li>Prioritize broadband infrastructure expansion in underserved neighborhoods</li>
          <li>Increase tree planting and green space in heat-vulnerable areas</li>
          <li>Improve public transportation connections to opportunity areas</li>
          <li>Invest in community facilities like libraries and recreation centers</li>
        </ul>
      </div>

      <div>
        <h4>Health & Environmental Equity</h4>
        <ul>
          <li>Address urban heat island effects through cool pavement and roof initiatives</li>
          <li>Reduce pollution exposure through buffer zones and emissions controls</li>
          <li>Increase access to healthy food options in food deserts</li>
          <li>Expand health services in medically underserved areas</li>
        </ul>
      </div>

      <div>
        <h4>Community Engagement & Reparative Justice</h4>
        <ul>
          <li>Create community oversight boards for development decisions</li>
          <li>Implement participatory budgeting processes</li>
          <li>Support cultural preservation and community history projects</li>
          <li>Establish truth and reconciliation processes around housing discrimination</li>
        </ul>
      </div>
    </div>

    <h3>Call to Action for San Jose Leaders</h3>
    <p>Targeted policies must address these historical inequities to break the cycle of inequality. We recommend creating a comprehensive Reparative Infrastructure Plan that:</p>

    <ol>
      <li>Prioritizes investment in historically marginalized neighborhoods</li>
      <li>Creates mechanisms for community control over development decisions</li>
      <li>Addresses both material disparities and historical trauma</li>
      <li>Establishes accountability measures to track progress</li>
    </ol>

    <p>By consciously addressing the legacy of redlining, San Jose can become a more equitable and just city for all residents.</p>
  </div>
</div>

<!-- Contact Section -->
<div id="contact-content" class="content-section">
  <div class="content-card">
    <h2>Contact</h2>
    <p>We welcome your questions, comments, and feedback about this research on the lasting impacts of redlining in San Jose.</p>

    <div class="contact-form">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" id="name" placeholder="Your name">
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Your email address">
      </div>

      <div class="form-group">
        <label for="message">Message</label>
        <textarea id="message" placeholder="Your message or question"></textarea>
      </div>

      <button class="submit-btn">Send Message</button>
    </div>

    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
      <h3>Additional Information</h3>
      <p><strong>Researcher:</strong> Aditya Rajesh</p>
      <p><strong>Email:</strong> example@email.com</p>
      <p><strong>Project Website:</strong> <a href="#">URL to be added</a></p>

      <div style="margin-top: 20px;">
        <p>To participate in our ongoing research or request a presentation for your organization, please complete our interest form:</p>
        <a href="https://forms.google.com" target="_blank" style="display: inline-block; background: #1a2a6c; color: white; padding: 12px 20px; border-radius: 4px; text-decoration: none; margin-top: 10px;">Google Interest Form</a>
      </div>
    </div>
  </div>
</div>

<!-- Tutorial Modal -->
<div id="tutorial-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2>Understanding Redlining in San Jose: Website Guide</h2>

    <h3>What You're Seeing</h3>
    <p>This interactive map shows the historical redlining zones in San Jose overlaid with contemporary data on infrastructure, demographics, and housing values.</p>

    <div style="display: flex; align-items: center; gap: 15px; margin: 20px 0; flex-wrap: wrap;">
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#2ca25f; margin-right: 8px;"></span>
        <span><strong>A (Green)</strong> - "Best"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#1f78b4; margin-right: 8px;"></span>
        <span><strong>B (Blue)</strong> - "Still Desirable"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#f1c40f; margin-right: 8px;"></span>
        <span><strong>C (Yellow)</strong> - "Declining"</span>
      </div>
      <div style="display: flex; align-items: center;">
        <span class="swatch" style="background:#e34a33; margin-right: 8px;"></span>
        <span><strong>D (Red)</strong> - "Hazardous"</strong></span>
      </div>
    </div>

    <h3>How to Use This Website</h3>

    <div class="chart-grid">
      <div>
        <h4>Exploring the Map</h4>
        <ul>
          <li>Click on any colored zone to see detailed information</li>
          <li>Use the + and - buttons to zoom in and out</li>
          <li>Toggle different layers on and off using the layer controls</li>
          <li>Hover over zones to see basic information</li>
        </ul>
      </div>

      <div>
        <h4>Understanding the Data</h4>
        <ul>
          <li>Each zone shows historical HOLC grade and contemporary data</li>
          <li>Compare infrastructure across different zones</li>
          <li>Note patterns between historical redlining and current conditions</li>
        </ul>
      </div>

      <div>
        <h4>Navigating the Sections</h4>
        <ul>
          <li>Use the tabs at the top to explore different aspects of the research</li>
          <li>The Graphs & Results section visualizes key findings</li>
          <li>Policy Implications suggests actions to address disparities</li>
        </ul>
      </div>

      <div>
        <h4>Taking Action</h4>
        <ul>
          <li>Contact us with questions or feedback</li>
          <li>Share this resource with others</li>
          <li>Consider how you might address these issues in your community</li>
        </ul>
      </div>
    </div>

    <h3>Key Variables Analyzed</h3>
    <p>This research examines multiple dimensions of inequality across historically redlined neighborhoods:</p>
    <ul>
      <li><strong>Broadband Access:</strong> Internet infrastructure and connectivity</li>
      <li><strong>Green Infrastructure:</strong> Street trees, parks, and green space</li>
      <li><strong>Transportation:</strong> Public transit access and rail infrastructure</li>
      <li><strong>Housing Values:</strong> Current property values and trends</li>
      <li><strong>Demographics:</strong> Racial composition and segregation patterns</li>
    </ul>

    <div style="text-align: center; margin-top: 30px;">
      <button class="submit-btn" id="start-exploring">Start Exploring</button>
    </div>
  </div>
</div>

<script>
  const TILEJSON_URL = "https://api.maptiler.com/tiles/01990763-49f0-77ce-b1b1-b97328f38e70/tiles.json?key=PrTVbrUk3PBatpAWhyvh";
  const FIELD_MAP = {
    grade: "grade",
    label: "label",
    median: "Median Housing Value",
    pct_white: "Percent White",
    pct_black: "Percent Black",
    pct_asian: "Percent Asian",
    pct_hisp: "Percent Hispanic",
    pct_native: "Percent Native American",
    broadband_anchors: "Broadband Anchors",
    street_trees: "Street Trees",
    rail_length: "Rail Length",
    light_rail_length: "Light Rail Length",
    broadband_served: "Broadband Percent Served",
    broadband_underserved: "Broadband Percent Underserved",
    broadband_priority: "Broadband Percent Priority Underserved"
  };

  // Tab Management
  const tabs = document.querySelectorAll('.tab');
  const contentSections = document.querySelectorAll('.content-section');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      // Remove active class from all tabs and sections
      tabs.forEach(t => t.classList.remove('active'));
      contentSections.forEach(s => s.classList.remove('active'));

      // Add active class to clicked tab
      tab.classList.add('active');

      // Show corresponding content section
      const tabId = tab.id;
      if (tabId === 'tab-map') {
        document.getElementById('map-container').classList.add('active');
        if (window._map) window._map.resize();
      } else if (tabId === 'tab-redlining') {
        document.getElementById('redlining-content').classList.add('active');
      } else if (tabId === 'tab-methodology') {
        document.getElementById('methodology-content').classList.add('active');
      } else if (tabId === 'tab-graphs') {
        document.getElementById('graphs-content').classList.add('active');
      } else if (tabId === 'tab-policy') {
        document.getElementById('policy-content').classList.add('active');
      } else if (tabId === 'tab-contact') {
        document.getElementById('contact-content').classList.add('active');
      } else if (tabId === 'tab-tutorial') {
        document.getElementById('tutorial-modal').style.display = 'block';
      }
    });
  });

  // Tutorial Modal
  const tutorialModal = document.getElementById('tutorial-modal');
  const closeModal = document.querySelector('.close-modal');
  const startExploringBtn = document.getElementById('start-exploring');

  // Show modal on page load
  window.addEventListener('load', () => {
    tutorialModal.style.display = 'block';
  });

  closeModal.addEventListener('click', () => {
    tutorialModal.style.display = 'none';
  });

  startExploringBtn.addEventListener('click', () => {
    tutorialModal.style.display = 'none';
  });

  // Circles interaction for Graphs & Results
  const circles = document.querySelectorAll('.circle');
  const circleInfos = document.querySelectorAll('.circle-info');

  circles.forEach(circle => {
    circle.addEventListener('click', () => {
      const category = circle.getAttribute('data-category');

      // Hide all info boxes
      circleInfos.forEach(info => {
        info.style.display = 'none';
      });

      // Show selected info box
      document.getElementById(`${category}-info`).style.display = 'block';
    });
  });

  // Map functions (same as before with modifications for light rail and fullscreen button)
  function getMapped(props, fieldId) {
    if (!props || !FIELD_MAP[fieldId]) return null;
    const k = FIELD_MAP[fieldId];
    return props.hasOwnProperty(k) ? props[k] : null;
  }

  function parseNumberFlexible(v) {
    if (v === null || v === undefined) return null;
    if (typeof v === 'number' && Number.isFinite(v)) return v;
    const s = String(v).trim();
    if (s === '' || ['null','nan'].includes(s.toLowerCase())) return null;
    if (s.includes('%')) {
      const n = Number(s.replace(/[%\s,]/g,''));
      return Number.isFinite(n) ? n : null;
    }
    const n = Number(s.replace(/[$,\s]/g,''));
    if (!Number.isFinite(n)) return null;
    return n;
  }

  function parsePercent(val) {
    const num = parseNumberFlexible(val);
    if (num === null || isNaN(num)) return 0;
    return num;
  }

  function formatNumber(n) {
    return (n === null || isNaN(n)) ? 'N/A' : Number(n).toLocaleString(undefined, {maximumFractionDigits:0});
  }

  function miniInlineBar(label, pct, color) {
    const p = pct ? Math.max(0, Math.min(100, pct)) : 0;
    return `<div style="display:flex;align-items:center;margin:4px 0;">
                  <div style="width:120px;font-size:12px">${label}</div>
                  <div style="background:#eee;width:160px;height:10px;border-radius:4px;overflow:hidden;margin-left:8px">
                      <div style="width:${p}%;height:100%;background:${color};"></div>
                  </div>
                  <div style="min-width:46px;text-align:right;margin-left:8px;font-size:12px">${p.toFixed(1)}%</div>
              </div>`;
  }

  function largeBarRow(label, pct, color) {
    const p = pct ? Math.max(0, Math.min(100, pct)) : 0;
    return `<div class="bar-row">
                  <div class="bar-label">${label}</div>
                  <div class="bar-track"><div class="bar-fill" style="width:${p}%;background:${color}"></div></div>
                  <div style="min-width:56px;text-align:right;font-weight:600">${p.toFixed(1)}%</div>
              </div>`;
  }

  function stackedSingleBarHtml(s,u,p,w=420) {
    const sum = (s||0)+(u||0)+(p||0);
    const ws = sum? (s/sum)*100:0, wu = sum? (u/sum)*100:0, wp = sum? (p/sum)*100:0;
    return `<div style="display:flex;align-items:center;gap:12px;margin:8px 0;">
                  <div style="width:160px">Broadband</div>
                  <div style="background:#eee;width:${w}px;height:18px;border-radius:4px;overflow:hidden;display:flex">
                      <div style="width:${ws}%;background:#2ca25f"></div>
                      <div style="width:${wu}%;background:#f1c40f"></div>
                      <div style="width:${wp}%;background:#e34a33"></div>
                  </div>
                  <div style="min-width:140px;text-align:right">${s.toFixed(1)}% served • ${u.toFixed(1)}% underserved • ${p.toFixed(1)}% priority</div>
              </div>`;
  }

  async function init() {
    const tj = await (await fetch(TILEJSON_URL)).json();
    const sourceLayer = tj.vector_layers?.[0]?.id;
    const style = {
      version: 8,
      sources: {
        osm: {
          type: "raster",
          tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
          tileSize: 256
        },
        "holc-tiles": {
          type: "vector",
          url: TILEJSON_URL
        }
      },
      layers: [{
        id: 'osm',
        type: 'raster',
        source: 'osm'
      }]
    };

    const map = new maplibregl.Map({
      container: 'map',
      style,
      center: [-121.8863, 37.3382],
      zoom: 12
    });
    window._map = map;

    // Add zoom controls
    document.getElementById('zoom-in').addEventListener('click', () => {
      map.zoomIn();
    });

    document.getElementById('zoom-out').addEventListener('click', () => {
      map.zoomOut();
    });

    map.on('load', () => {
      // Add HOLC polygons
      map.addLayer({
        id: 'holc-fill',
        type: 'fill',
        source: 'holc-tiles',
        'source-layer': sourceLayer,
        paint: {
          'fill-color': [
            'match',
            ['get', 'grade'],
            'A', '#2ca25f',
            'B', '#1f78b4',
            'C', '#f1c40f',
            'D', '#e34a33',
            '#999'
          ],
          'fill-opacity': 0.65
        }
      });

      map.addLayer({
        id: 'holc-line',
        type: 'line',
        source: 'holc-tiles',
        'source-layer': sourceLayer,
        paint: {
          'line-color': '#222',
          'line-width': 1
        }
      });

      // Add infrastructure layers
      // Rail
      map.addSource('rail', {
        type: 'geojson',
        data: 'https://api.maptiler.com/data/01990e77-7d61-7687-8575-6e804eb532f6/features.json?key=PrTVbrUk3PBatpAWhyvh'
      });

      map.addLayer({
        id: 'rail-line',
        type: 'line',
        source: 'rail',
        layout: { visibility: 'none' },
        paint: {
          'line-color': '#000000',
          'line-width': 2,
          'line-dasharray': [2, 2]
        }
      });

      // Light Rail - updated with brighter green and thicker line
      map.addSource('light-rail', {
        type: 'geojson',
        data: 'https://api.maptiler.com/data/0199215c-1501-7b68-9122-47e0167261d4/features.json?key=PrTVbrUk3PBatpAWhyvh'
      });

      map.addLayer({
        id: 'light-rail-line',
        type: 'line',
        source: 'light-rail',
        layout: { visibility: 'visible' },
        paint: {
          'line-color': '#4CAF50', // Bright green
          'line-width': 4, // Thicker line
        }
      });

      // Broadband Anchors
      map.addSource('broadband-anchors', {
        type: 'geojson',
        data: 'https://api.maptiler.com/data/01992159-807d-79ae-93a9-a66d86e84ca9/features.json?key=PrTVbrUk3PBatpAWhyvh'
      });

      map.addLayer({
        id: 'broadband-anchors-point',
        type: 'circle',
        source: 'broadband-anchors',
        layout: { visibility: 'none' },
        paint: {
          'circle-radius': 4,
          'circle-color': '#3498db',
          'circle-stroke-width': 1,
          'circle-stroke-color': '#fff'
        }
      });

      const popup = new maplibregl.Popup({
        closeButton: true,
        closeOnClick: true,
        maxWidth: '380px'
      });

      map.on('mousemove', 'holc-fill', e => {
        const props = e.features[0].properties;
        infoBox.innerHTML = `<strong>${getMapped(props, 'label') || 'Zone'}</strong><br/>Grade: ${getMapped(props, 'grade') || 'N/A'}`;
      });

      map.on('mouseleave', 'holc-fill', () => infoBox.innerText = 'Hover a polygon');

      map.on('click', 'holc-fill', e => {
        const props = e.features[0].properties;
        const grade = getMapped(props, 'grade'), label = getMapped(props, 'label');
        const median = parseNumberFlexible(getMapped(props, 'median'));
        const pctWhite = parseNumberFlexible(getMapped(props, 'pct_white'));
        const pctBlack = parseNumberFlexible(getMapped(props, 'pct_black'));
        const pctAsian = parseNumberFlexible(getMapped(props, 'pct_asian'));
        const pctHisp = parseNumberFlexible(getMapped(props, 'pct_hisp'));
        const pctNative = parseNumberFlexible(getMapped(props, 'pct_native'));
        const broadbandAnchors = parseNumberFlexible(getMapped(props, 'broadband_anchors'));
        const streetTrees = parseNumberFlexible(getMapped(props, 'street_trees'));
        const railLength = parseNumberFlexible(getMapped(props, 'rail_length')) || 0;
        const lightRailLength = parseNumberFlexible(getMapped(props, 'light_rail_length')) || 0;
        const bs = parsePercent(getMapped(props, 'broadband_served'));
        const bu = parsePercent(getMapped(props, 'broadband_underserved'));
        const bp = parsePercent(getMapped(props, 'broadband_priority'));

        let html = `<div class="popup-table"><div class="popup-scroll">
                          <div><span class="metric">Grade:</span> ${grade}<br/><span class="metric">Label:</span> ${label}</div>
                          <div><span class="metric">Median Housing Value:</span> ${median ? '$' + formatNumber(median) : 'N/A'}</div>
                          <div><strong>Race %</strong>
                              ${miniInlineBar('White', pctWhite, '#1f78b4')}
                              ${miniInlineBar('Black', pctBlack, '#6a3d9a')}
                              ${miniInlineBar('Asian', pctAsian, '#b15928')}
                              ${miniInlineBar('Hispanic', pctHisp, '#ff7f00')}
                              ${miniInlineBar('Native', pctNative, '#777')}
                          </div>
                          <div><strong>Counts</strong>
                              <div>Broadband Anchors: ${formatNumber(broadbandAnchors)}</div>
                              <div>Street Trees: ${formatNumber(streetTrees)}</div>
                              <div>Rail Length: ${railLength}</div>
                              <div>Light Rail Length: ${lightRailLength}</div>
                          </div>
                          <div><strong>Broadband %</strong>
                              ${stackedSingleBarHtml(bs || 0, bu || 0, bp || 0, 180)}
                          </div>
                      </div></div>`;

        // Add fullscreen button to popup
        html += `<button class="fullscreen-btn" onclick="showFullscreenDetails()">Fullscreen</button>`;

        popup.setLngLat(e.lngLat).setHTML(html).addTo(map);
      });

      // Layer toggles
      document.getElementById('toggle-holc').onchange = (e) => {
        const v = e.target.checked ? 'visible' : 'none';
        map.setLayoutProperty('holc-fill', 'visibility', v);
        map.setLayoutProperty('holc-line', 'visibility', v);
      };

      document.getElementById('toggle-rail').onchange = (e) => {
        const v = e.target.checked ? 'visible' : 'none';
        map.setLayoutProperty('rail-line', 'visibility', v);
      };

      document.getElementById('toggle-light-rail').onchange = (e) => {
        const v = e.target.checked ? 'visible' : 'none';
        map.setLayoutProperty('light-rail-line', 'visibility', v);
      };

      document.getElementById('toggle-broadband').onchange = (e) => {
        const v = e.target.checked ? 'visible' : 'none';
        map.setLayoutProperty('broadband-anchors-point', 'visibility', v);
      };
    });
  }

  // Fullscreen details function
  function showFullscreenDetails() {
    // For simplicity, just switch to the Graphs & Results tab
    tabs.forEach(t => t.classList.remove('active'));
    contentSections.forEach(s => s.classList.remove('active'));

    document.getElementById('tab-graphs').classList.add('active');
    document.getElementById('graphs-content').classList.add('active');
  }

  init();
</script>
</body>
</html>